<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Maya Casino VIP üá¨üáπ</title>
    <style>
        :root { --gold: #ffd700; --blue: #0092bc; --dark: #0f172a; --win: #22c55e; --card: #1e293b; --danger: #ef4444; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background-color: var(--dark); color: white; font-family: sans-serif; margin: 0; padding: 0; width: 100vw; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }
        header { background: #000; padding: 10px 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--blue); }
        .balance-pill { background: rgba(255, 215, 0, 0.1); padding: 5px 12px; border-radius: 20px; border: 1px solid var(--gold); color: var(--gold); font-weight: bold; }
        main { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; align-items: center; }
        .view { display: none; width: 100%; animation: fadeIn 0.2s ease; }
        .active { display: block; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 100%; margin-top: 10px; }
        .menu-card { background: var(--card); padding: 15px 5px; border-radius: 12px; border: 1px solid #334155; text-align: center; font-weight: bold; font-size: 0.8rem; }
        .game-box { background: var(--card); padding: 15px; border-radius: 15px; border: 1px solid #334155; width: 100%; text-align: center; }
        .display-area { font-size: 2.5rem; margin: 15px 0; background: #000; border-radius: 10px; padding: 10px; }
        input, select { width: 100%; padding: 12px; margin: 5px 0; border-radius: 8px; border: 1px solid var(--blue); background: #000; color: white; text-align: center; font-size: 1rem; }
        .btn-play { background: var(--gold); color: #000; border: none; padding: 14px; width: 100%; border-radius: 10px; font-weight: bold; margin-top: 10px; }
        .btn-redeem { background: var(--win); color: white; border: none; padding: 12px; width: 100%; border-radius: 10px; font-weight: bold; margin-bottom: 8px; display: flex; justify-content: space-between; }
        .btn-back { background: #334155; color: white; border: none; padding: 10px; width: 100%; border-radius: 8px; margin-top: 15px; }
        .aviator-stage { position: relative; width: 100%; height: 150px; background: #000; border-radius: 12px; overflow: hidden; margin-bottom: 10px; }
        #plane-img { position: absolute; bottom: 15px; left: 5%; width: 35px; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <header>
        <div><div style="font-weight: bold; color: var(--blue);">MAYA CASINO</div><div id="header-id" style="font-size: 0.6rem; color: #94a3b8;">ID: ...</div></div>
        <div class="balance-pill">Q <span id="balance">0.00</span></div>
    </header>

    <main>
        <div id="menu-view" class="view active">
            <div class="grid">
                <div class="menu-card" onclick="showView('aviator-view')" style="border: 2px solid var(--danger); grid-column: span 2;">‚úàÔ∏è MAYA AVIATOR</div>
                <div class="menu-card" onclick="showView('slots-view')">üé∞ SLOTS</div>
                <div class="menu-card" onclick="showView('dice-view')">üé≤ DADOS</div>
                <div class="menu-card" onclick="showView('coin-view')">ü™ô CARA/ESCUDO</div>
                <div class="menu-card" onclick="showView('color-view')">üî¥ ROJO/NEGRO</div>
                <div class="menu-card" onclick="showView('payment-view')" style="border-color: var(--blue);">üí≥ MIS DATOS</div>
                <div class="menu-card" onclick="showView('exchange-view')" style="border-color: var(--win);">üí∞ COBRAR</div>
            </div>
            <button class="btn-play" onclick="showView('recharge-view')" style="background:var(--blue); color:white; margin-top:15px;">üéüÔ∏è RECARGAS / OFERTAS</button>
        </div>

        <div id="aviator-view" class="view">
            <div class="game-box">
                <div class="aviator-stage"><div id="aviator-res" style="font-size:2.5rem; margin-top:40px;">1.00x</div><img id="plane-img" src="https://img.icons8.com/emoji/96/airplane-emoji.png"></div>
                <input type="number" id="bet-aviator" value="10">
                <button id="btn-avi-start" class="btn-play" onclick="startAviator()">APOSTAR</button>
                <button id="btn-avi-cash" class="btn-play" style="background:var(--win); display:none;" onclick="cashoutAviator()">RETIRAR</button>
            </div>
            <button class="btn-back" onclick="showView('menu-view')">Volver</button>
        </div>

        <div id="dice-view" class="view">
            <div class="game-box">
                <div class="display-area" id="dice-res">üé≤</div>
                <input type="number" id="dice-guess" placeholder="N√∫mero (1-6)">
                <input type="number" id="bet-dice" value="10">
                <button class="btn-play" onclick="playDice()">LANZAR</button>
            </div>
            <button class="btn-back" onclick="showView('menu-view')">Volver</button>
        </div>

        <div id="coin-view" class="view">
            <div class="game-box">
                <div class="display-area" id="coin-res">ü™ô</div>
                <select id="coin-choice"><option value="CARA">CARA</option><option value="ESCUDO">ESCUDO</option></select>
                <input type="number" id="bet-coin" value="10">
                <button class="btn-play" onclick="playCoin()">LANZAR</button>
            </div>
            <button class="btn-back" onclick="showView('menu-view')">Volver</button>
        </div>

        <div id="color-view" class="view">
            <div class="game-box">
                <div class="display-area" id="color-res">‚ö™</div>
                <select id="color-choice"><option value="ROJO">ROJO</option><option value="NEGRO">NEGRO</option></select>
                <input type="number" id="bet-color" value="10">
                <button class="btn-play" onclick="playColor()">APOSTAR</button>
            </div>
            <button class="btn-back" onclick="showView('menu-view')">Volver</button>
        </div>

        <div id="exchange-view" class="view">
            <div class="game-box">
                <h3 style="color:var(--win)">COBROS DISPONIBLES</h3>
                <button class="btn-redeem" onclick="solicitarCobro(12000)"><span>Q12,000</span> <b>COBRAR</b></button>
                <button class="btn-redeem" onclick="solicitarCobro(20000)"><span>Q20,000</span> <b>COBRAR</b></button>
            </div>
            <button class="btn-back" onclick="showView('menu-view')">Volver</button>
        </div>

        <div id="slots-view" class="view">
            <div class="game-box"><div id="slot-res" class="display-area">üé∞üé∞üé∞</div><input type="number" id="bet-slots" value="10"><button class="btn-play" onclick="playSlots()">GIRAR</button></div>
            <button class="btn-back" onclick="showView('menu-view')">Volver</button>
        </div>

        <div id="payment-view" class="view">
            <div class="game-box">
                <input type="text" id="dat-nombre" placeholder="Nombre Completo">
                <input type="number" id="dat-cuenta" placeholder="No. de Cuenta">
                <button class="btn-play" onclick="savePaymentData()">GUARDAR</button>
            </div>
            <button class="btn-back" onclick="showView('menu-view')">Volver</button>
        </div>
        
        <div id="recharge-view" class="view"><div class="game-box"><h3>OFERTAS</h3><div id="dynamic-promos">No hay ofertas hoy.</div></div><button class="btn-back" onclick="showView('menu-view')">Volver</button></div>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, onSnapshot, setDoc, updateDoc, collection, addDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyDusYsceOFaSRl7a9UNjYYVVX4scR2J2iY", authDomain: "cacino-ff54f.firebaseapp.com", projectId: "cacino-ff54f", storageBucket: "cacino-ff54f.firebasestorage.app", messagingSenderId: "783971947416", appId: "1:783971947416:web:21001456f59817888511ed" };
        const app = initializeApp(firebaseConfig); const db = getFirestore(app);

        let userId = localStorage.getItem('casino_id') || "MAYA_" + Math.floor(Math.random()*9999);
        localStorage.setItem('casino_id', userId);
        document.getElementById('header-id').innerText = "ID: " + userId;
        
        let balance = 0; const userRef = doc(db, "usuarios", userId);
        onSnapshot(userRef, (s) => { if(s.exists()){ balance = s.data().saldo; document.getElementById('balance').innerText = balance.toLocaleString(); } else { setDoc(userRef, { saldo: 0 }); } });

        window.showView = (id) => { document.querySelectorAll('.view').forEach(v => v.classList.remove('active')); document.getElementById(id).classList.add('active'); };

        // L√ìGICA DE TODOS LOS JUEGOS
        window.playDice = async () => { const b = parseFloat(document.getElementById('bet-dice').value); const g = parseInt(document.getElementById('dice-guess').value); if(b > balance) return; const r = Math.floor(Math.random()*6)+1; document.getElementById('dice-res').innerText = "üé≤ " + r; if(g===r){ await updateDoc(userRef, { saldo: balance + (b*5) }); } else { await updateDoc(userRef, { saldo: balance - b }); } };
        window.playCoin = async () => { const b = parseFloat(document.getElementById('bet-coin').value); const c = document.getElementById('coin-choice').value; if(b > balance) return; const r = Math.random() < 0.5 ? "CARA" : "ESCUDO"; document.getElementById('coin-res').innerText = r; if(c===r){ await updateDoc(userRef, { saldo: balance + b }); } else { await updateDoc(userRef, { saldo: balance - b }); } };
        window.playColor = async () => { const b = parseFloat(document.getElementById('bet-color').value); const c = document.getElementById('color-choice').value; if(b > balance) return; const r = Math.random() < 0.5 ? "ROJO" : "NEGRO"; document.getElementById('color-res').innerText = r === "ROJO" ? "üî¥" : "‚ö´"; if(c===r){ await updateDoc(userRef, { saldo: balance + b }); } else { await updateDoc(userRef, { saldo: balance - b }); } };
        window.playSlots = async () => { const b = parseFloat(document.getElementById('bet-slots').value); if(b > balance) return; const items = ["üçí","üíé","üîî"]; const r1=items[Math.floor(Math.random()*3)], r2=items[Math.floor(Math.random()*3)], r3=items[Math.floor(Math.random()*3)]; document.getElementById('slot-res').innerText = r1+r2+r3; if(r1===r2 && r2===r3){ await updateDoc(userRef, { saldo: balance + (b*10) }); } else { await updateDoc(userRef, { saldo: balance - b }); } };

        // AVIATOR
        let aviInt, mult = 1.0, flying = false;
        window.startAviator = async () => {
            const bet = parseFloat(document.getElementById('bet-aviator').value); if(bet > balance) return;
            flying = true; mult = 1.0; await updateDoc(userRef, { saldo: balance - bet });
            document.getElementById('btn-avi-start').style.display = 'none'; document.getElementById('btn-avi-cash').style.display = 'block';
            let crash = (Math.random() * 3 + 1.1);
            aviInt = setInterval(() => {
                mult += 0.05; document.getElementById('aviator-res').innerText = mult.toFixed(2) + "x";
                if(mult >= crash){ clearInterval(aviInt); flying = false; document.getElementById('aviator-res').innerText = "¬°SE FUE!"; setTimeout(() => { document.getElementById('btn-avi-start').style.display = 'block'; document.getElementById('btn-avi-cash').style.display = 'none'; }, 2000); }
            }, 100);
        };
        window.cashoutAviator = async () => { if(!flying) return; clearInterval(aviInt); flying = false; await updateDoc(userRef, { saldo: balance + Math.floor(parseFloat(document.getElementById('bet-aviator').value)*mult) }); document.getElementById('btn-avi-start').style.display = 'block'; document.getElementById('btn-avi-cash').style.display = 'none'; };

        // CANJES Y DATOS
        window.savePaymentData = async () => { const nom = document.getElementById('dat-nombre').value; const cue = document.getElementById('dat-cuenta').value; if(!nom || !cue) return alert("Faltan datos"); await updateDoc(userRef, { datosPago: { nombre: nom, cuenta: cue } }); alert("Datos Guardados"); };
        window.solicitarCobro = async (premio) => { const s = await getDoc(userRef); if(balance < premio) return alert("Saldo insuficiente"); if(confirm("¬øCobrar Q"+premio+"?")){ await updateDoc(userRef, { saldo: balance - premio }); await addDoc(collection(db, "solicitudes_globales"), { usuario: userId, monto: premio, estado: "Pendiente" }); alert("Solicitud enviada"); } };
    </script>
</body>
</html>
